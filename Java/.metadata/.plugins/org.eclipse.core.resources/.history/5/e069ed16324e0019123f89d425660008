package assigment1.tucn.cs.UI;

import java.util.Objects;

import assigment1.tucn.cs.BLL.LoginService;
import assigment1.tucn.cs.DAL.Student;
import assigment1.tucn.cs.DAL.StudentRepository;
import assigment1.tucn.cs.DAL.Teacher;
import assigment1.tucn.cs.DAL.TeacherRepository;
import assigment1.tucn.cs.DAL.User;
import assigment1.tucn.cs.database.config.JDBConnectionConfig;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.TextField;

public class Controller {

	private static final String SCHEMA = "university_db";
	private String checkUser;
	private String checkPassword;
	private Long currentStudentId;
	private JDBConnectionConfig dbConnectionWrapper = new JDBConnectionConfig(SCHEMA);
	private StudentRepository studentRepo = new StudentRepository(dbConnectionWrapper);
	private TeacherRepository teacherRepo = new TeacherRepository(dbConnectionWrapper);
	private LoginService loginService = new LoginService(studentRepo, teacherRepo);

	@FXML
	private TextField password;

	@FXML
	private TextField userName;

	@FXML
	private TextField AddressField;

	@FXML
	private TextField groupField;

	@FXML
	private TextField idField;

	@FXML
	private TextField PncField;

	@FXML
	private TextField nameField;

	@FXML
	private TextField IcnField;

	@FXML
	void updateStudentButtonClicked(ActionEvent event) {
		System.out.println("Update!");
	}

	@FXML
	void loginButtonClicked(ActionEvent event) {
		User currentUser = null;
		checkUser = userName.getText().toString();
		checkPassword = password.getText().toString();
		try {
			System.out.println(checkUser + checkPassword);
			currentUser = loginService.login(checkUser, checkPassword);
			if (currentUser instanceof Teacher) {
				lblMessage.setText("TEACHER!");
			} else if (currentUser instanceof Student) {
				lblMessage.setText("STUDENT!");
				primaryStage.close();
				studentPage();
			} else if (Objects.isNull(currentUser)) {
				lblMessage.setText("Username or password invalid!!");
			}
	}

}
