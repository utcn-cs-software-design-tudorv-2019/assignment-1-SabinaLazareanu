package assigment1.tucn.cs.BLL;

import static assigment1.tucn.cs.BLL.utils.ETables.STUDENT;
import static assigment1.tucn.cs.BLL.utils.ETables.USER;

import java.util.List;
import java.util.Objects;

import assigment1.tucn.cs.DAL.ExecutionException;
import assigment1.tucn.cs.DAL.Student;
import assigment1.tucn.cs.DAL.StudentRepository;
import assigment1.tucn.cs.DAL.Teacher;
import assigment1.tucn.cs.DAL.TeacherRepository;
import assigment1.tucn.cs.DAL.User;
import assigment1.tucn.cs.DAL.UserRepository;

public class LoginService {

	private static final String ADMIN_USER = "admin";
	private static final String ADMIN_PASSWORD = "admin";

	private StudentRepository studentRepo;
	private TeacherRepository teacherRepo;
	private UserRepository userRepo;

	public LoginService(StudentRepository studentRepo, TeacherRepository teacherRepo, UserRepository userRepo) {
		this.studentRepo = studentRepo;
		this.teacherRepo = teacherRepo;
		this.userRepo = userRepo;
	}

	public User login(String userName, String password) throws ExecutionException {
		User currentUser = null;
		if (password.equalsIgnoreCase(ADMIN_USER)) {
			if (userName.equalsIgnoreCase(ADMIN_PASSWORD)) {
				currentUser = new Teacher();
			}
		} else {
			List<Student> students = (List<Student>) studentRepo.findAll(STUDENT);
			for (Student student : students) {
				if (student.getUserName().equals(userName)) {
					if (student.getPassword().equals(password)) {
						currentUser = student;
						if (Objects.nonNull(currentUser)) {
							User student_user;
							student_user = userRepo.getById(student._getIdUser(), USER);
						}
					}
				}
			}
		}

		return currentUser;
	}

}
